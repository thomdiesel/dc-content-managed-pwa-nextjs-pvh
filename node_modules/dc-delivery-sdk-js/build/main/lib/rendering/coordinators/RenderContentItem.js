"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Url_1 = require("../../utils/Url");
var RenderedContentItem_1 = require("../model/RenderedContentItem");
var Edition_1 = require("../../content/model/Edition");
var ContentLifecycle_1 = require("../../content/model/ContentLifecycle");
/**
 * @hidden
 */
var RenderContentItem = /** @class */ (function () {
    function RenderContentItem(config, contentClient) {
        this.config = config;
        this.contentClient = contentClient;
    }
    RenderContentItem.prototype.renderContentItem = function (contentItemId, templateName, customParameters) {
        var _this = this;
        var queryParameters = this.getQueryParams(templateName, customParameters);
        var queryString = Url_1.encodeQueryString(queryParameters);
        var path = "/v1/content/" + encodeURIComponent(this.config.account) + "/content-item/" + encodeURIComponent(contentItemId);
        return this.contentClient.get(path + "?" + queryString).then(function (response) {
            return _this.parseResponse(response);
        });
    };
    RenderContentItem.prototype.getQueryParams = function (templateName, customParameters) {
        var queryParameters = [['template', templateName]];
        if (customParameters) {
            for (var _i = 0, _a = Object.keys(customParameters); _i < _a.length; _i++) {
                var key = _a[_i];
                var value = customParameters[key];
                queryParameters.push(["crparam." + key, value]);
            }
        }
        if (this.config.locale) {
            queryParameters.push(['locale', this.config.locale]);
        }
        return queryParameters;
    };
    RenderContentItem.prototype.parseResponse = function (response) {
        var headers = response.headers;
        var result = new RenderedContentItem_1.RenderedContentItem();
        result.body = response.data;
        if (headers) {
            var editionId = headers['X-Amp-Edition-ID'];
            var editionStart = headers['X-Amp-Edition-Start-Time'];
            var editionEnd = headers['X-Amp-Edition-End-Time'];
            var lifecycleExpiryTime = headers['X-Amp-Lifecycle-Expiry-Time'];
            if (editionId) {
                result.edition = new Edition_1.Edition({
                    id: editionId,
                    start: editionStart,
                    end: editionEnd
                });
            }
            if (lifecycleExpiryTime) {
                result.lifecycle = new ContentLifecycle_1.ContentLifecycle({
                    expiryTime: lifecycleExpiryTime
                });
            }
        }
        return result;
    };
    return RenderContentItem;
}());
exports.RenderContentItem = RenderContentItem;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVuZGVyQ29udGVudEl0ZW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL3JlbmRlcmluZy9jb29yZGluYXRvcnMvUmVuZGVyQ29udGVudEl0ZW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSx1Q0FBb0Q7QUFFcEQsb0VBQW1FO0FBQ25FLHVEQUFzRDtBQUN0RCx5RUFBd0U7QUFFeEU7O0dBRUc7QUFDSDtJQUNFLDJCQUNtQixNQUEyQixFQUMzQixhQUE0QjtRQUQ1QixXQUFNLEdBQU4sTUFBTSxDQUFxQjtRQUMzQixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtJQUM1QyxDQUFDO0lBRUosNkNBQWlCLEdBQWpCLFVBQ0UsYUFBcUIsRUFDckIsWUFBb0IsRUFDcEIsZ0JBQTJDO1FBSDdDLGlCQWFDO1FBUkMsSUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUM1RSxJQUFNLFdBQVcsR0FBRyx1QkFBaUIsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUN2RCxJQUFNLElBQUksR0FBRyxpQkFBZSxrQkFBa0IsQ0FDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQ3BCLHNCQUFpQixrQkFBa0IsQ0FBQyxhQUFhLENBQUcsQ0FBQztRQUN0RCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFJLElBQUksU0FBSSxXQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxRQUFRO1lBQ25FLE9BQU8sS0FBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCwwQ0FBYyxHQUFkLFVBQ0UsWUFBb0IsRUFDcEIsZ0JBQTJDO1FBRTNDLElBQU0sZUFBZSxHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUVyRCxJQUFJLGdCQUFnQixFQUFFO1lBQ3BCLEtBQWtCLFVBQTZCLEVBQTdCLEtBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUE3QixjQUE2QixFQUE3QixJQUE2QixFQUFFO2dCQUE1QyxJQUFNLEdBQUcsU0FBQTtnQkFDWixJQUFNLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDcEMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLGFBQVcsR0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7YUFDakQ7U0FDRjtRQUVELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7WUFDdEIsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7U0FDdEQ7UUFFRCxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDO0lBRUQseUNBQWEsR0FBYixVQUFjLFFBQXVCO1FBQ25DLElBQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUM7UUFFakMsSUFBTSxNQUFNLEdBQUcsSUFBSSx5Q0FBbUIsRUFBRSxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztRQUU1QixJQUFJLE9BQU8sRUFBRTtZQUNYLElBQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQzlDLElBQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBQ3pELElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBQ3JELElBQU0sbUJBQW1CLEdBQUcsT0FBTyxDQUFDLDZCQUE2QixDQUFDLENBQUM7WUFFbkUsSUFBSSxTQUFTLEVBQUU7Z0JBQ2IsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLGlCQUFPLENBQUM7b0JBQzNCLEVBQUUsRUFBRSxTQUFTO29CQUNiLEtBQUssRUFBRSxZQUFZO29CQUNuQixHQUFHLEVBQUUsVUFBVTtpQkFDaEIsQ0FBQyxDQUFDO2FBQ0o7WUFFRCxJQUFJLG1CQUFtQixFQUFFO2dCQUN2QixNQUFNLENBQUMsU0FBUyxHQUFHLElBQUksbUNBQWdCLENBQUM7b0JBQ3RDLFVBQVUsRUFBRSxtQkFBbUI7aUJBQ2hDLENBQUMsQ0FBQzthQUNKO1NBQ0Y7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBQ0gsd0JBQUM7QUFBRCxDQUFDLEFBdEVELElBc0VDO0FBdEVZLDhDQUFpQiJ9